---
name: Build and push Docker Image on Tag

on:
  push:
    tags:
      - '*'

jobs:
  create-release:
    runs-on: ubuntu-latest
    permissions:
      actions: read
      contents: write
    steps:
      - name: create sbom
        uses: aquasecurity/trivy-action@e5f43133f6e8736992c9f3c1b3296e24b37e17f2
        with:
          scan-type: 'image'
          format: 'cyclonedx'
          image-ref: 'docker.io/schulcloud/schulcloud-server:31.5.1'
          output: 'dependency-results.sbom.json'
      - name: create release
        uses: softprops/action-gh-release@v1
        with:
          body: 'refer to the schulcloud-client release notes https://github.com/hpi-schul-cloud/schulcloud-client/releases/'
          files: dependency-results.sbom.json
